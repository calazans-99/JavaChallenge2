<!-- templates/fragmentos.html -->

<head xmlns:th="http://www.thymeleaf.org" th:fragment="cabecalho(titulo)">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <title th:text="${titulo}"></title>
</head>

<form xmlns:th="http://www.thymeleaf.org" th:fragment="form-logout" th:action="@{/logout}" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit" class="btn btn-outline-secondary" style="float: right;">Sair</button>
</form>

<!-- Saudação (segura quando 'usuario' for nulo) -->
<div xmlns:th="http://www.thymeleaf.org" th:fragment="saudacoes(usuario)" class="d-flex align-items-center">
    <img th:src="${usuario != null and usuario.imgPerfil != null and !#strings.isEmpty(usuario.imgPerfil)
               ? usuario.imgPerfil : 'https://via.placeholder.com/100'}"
         alt="Imagem de Perfil"
         style="width: 100px; height: auto; border-radius: 50%;">
    <h1 class="ms-2">
        <b>Olá, <span th:text="${usuario != null and usuario.nomePerfil != null ? usuario.nomePerfil : 'usuário'}"></span>!</b>
    </h1>
</div>

<!-- Botão Voltar com destino fixo; cai no /index se não for passado -->
<div xmlns:th="http://www.thymeleaf.org" th:fragment="voltar(to)">
    <a class="btn btn-outline-secondary"
       th:href="${to} == null ? @{/index} : ${to}">⟵ Voltar</a>
</div>

<!-- Botão Voltar que tenta o histórico e tem fallback -->
<div xmlns:th="http://www.thymeleaf.org" th:fragment="voltar-historico(fallback)">
    <button type="button" class="btn btn-outline-secondary"
            th:attr="data-fallback=${fallback} == null ? @{/index} : ${fallback}"
            onclick="(history.length>1)?history.back():location.href=this.dataset.fallback">
        ⟵ Voltar
    </button>
</div>

<!-- Cabeçalho pronto: título + Voltar -->
<div xmlns:th="http://www.thymeleaf.org" th:fragment="page-header(titulo, destino)">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 th:text="${titulo}">Título</h1>
        <div th:replace="~{fragmentos :: voltar(${destino})}"></div>
    </div>
</div>

<!-- Alerts para flash attributes (msg/erro) - pode usar em QUALQUER página -->
<div xmlns:th="http://www.thymeleaf.org" th:fragment="alerts">
    <div th:if="${msg}"  class="alert alert-success alert-dismissible fade show" role="alert" th:text="${msg}"></div>
    <div th:if="${erro}" class="alert alert-danger  alert-dismissible fade show" role="alert" th:text="${erro}"></div>
</div>

<!-- Erros globais de validação - usar DENTRO de <form th:object="..."> -->
<div xmlns:th="http://www.thymeleaf.org" th:fragment="form-errors">
    <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger">
        <ul class="mb-0">
            <li th:each="e : ${#fields.globalErrors()}" th:text="${e}">Erro</li>
        </ul>
    </div>
</div>

<!-- Scripts de rodapé (opcional) -->
<div xmlns:th="http://www.thymeleaf.org" th:fragment="rodape-scripts">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>
</div>
